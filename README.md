<div align="center">

# ğŸ¤– Chat Bridge

### _The Ultimate AI Conversation Orchestration Platform_
### --The results of when a Steel Fabricator gets his hands on AI and finds Github.--
https://quantummindsunited.com/

[![Tests](https://github.com/meistro57/chat_bridge/actions/workflows/laravel.yml/badge.svg)](https://github.com/meistro57/chat_bridge/actions/workflows/laravel.yml)
[![PHP Version](https://img.shields.io/badge/PHP-8.2%2B-777BB4?logo=php&logoColor=white)](https://www.php.net/)
[![Laravel](https://img.shields.io/badge/Laravel-12.x-FF2D20?logo=laravel&logoColor=white)](https://laravel.com)
[![React](https://img.shields.io/badge/React-18-61DAFB?logo=react&logoColor=black)](https://react.dev)
[![Tailwind](https://img.shields.io/badge/Tailwind-v3-38BDF8?logo=tailwind-css&logoColor=white)](https://tailwindcss.com)
[![Docker](https://img.shields.io/badge/Docker-Ready-2496ED?logo=docker&logoColor=white)](https://www.docker.com/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![Made with Love](https://img.shields.io/badge/Made%20with-%E2%9D%A4%EF%B8%8F-red)](https://github.com/meistro57/chat_bridge)

**Current Version:** 0.8.0

**Orchestrate intelligent conversations between AI agents. Test, experiment, and explore multi-agent AI systems with enterprise-grade tooling.**

[Features](#-features) â€¢ [Installation](#-installation) â€¢ [Docker Setup](#-docker-deployment) â€¢ [Documentation](#-documentation) â€¢ [Contributing](#-contributing)

---

</div>

## ğŸŒŸ What is Chat Bridge?

Chat Bridge is a **production-ready AI conversation orchestration platform** that enables you to:

- ğŸ­ **Create AI Personas** with custom behaviors, system prompts, and parameters
- ğŸ’¬ **Orchestrate Conversations** between different AI agents in real-time
- ğŸ“Š **Analyze Interactions** with advanced analytics and full conversation history
- ğŸ” **Manage Credentials** securely with encrypted API key storage
- ğŸ§  **Leverage RAG** for context-aware conversations with persistent memory
- ğŸ› **Debug Everything** with built-in Telescope and Debugbar integration
- ğŸ¨ **Enjoy Dark Mode** with our stunning "Midnight Glass" UI design

Perfect for **AI researchers, developers, and enthusiasts** who want to experiment with multi-agent systems, test AI behaviors, generate synthetic training data, or simply explore the fascinating world of AI-to-AI conversations.

---

## ğŸ‰ ğŸš¨ **INTRODUCING: AUTONOMOUS SELF-HEALING** ğŸš¨ ğŸ‰

<div align="center">

### ğŸ¤– **Meet Codex: Your Application's AI Guardian** ğŸ¤–

</div>

Chat Bridge features a **groundbreaking autonomous AI agent** called **Codex** that can diagnose, analyze, and provide actionable insights for your entire Laravel applicationâ€”**automatically**.

<table>
<tr>
<td width="50%" valign="top">

### ğŸ§  **What is Codex?**

Codex is an **AI-powered diagnostic agent** that understands your Laravel application at a deep level. It's not just a chatbotâ€”it's a **self-aware system analyst** that can:

- ğŸ” **Analyze database performance** - Find N+1 queries, missing indexes, slow queries
- ğŸ› **Debug recent errors** - Identify patterns, root causes, and suggest fixes
- ğŸ”’ **Security audits** - Check for vulnerabilities, exposed keys, CSRF issues
- âš¡ **Performance analysis** - Identify bottlenecks, memory issues, cache problems
- ğŸ§ª **Test coverage** - Analyze tests and suggest improvements
- âœ¨ **Code quality** - Review Laravel best practices and SOLID principles
- ğŸ“¦ **Dependency audits** - Find outdated packages and security issues
- ğŸ—„ï¸ **Migration reviews** - Check indexing, constraints, and optimizations

</td>
<td width="50%" valign="top">

### âš¡ **Autonomous Capabilities**

**Codex isn't just reactiveâ€”it's proactive:**

```
ğŸ¤– Codex detects a slow query
   â†“
ğŸ” Analyzes execution plan
   â†“
ğŸ“Š Checks table indexes
   â†“
ğŸ’¡ Identifies missing index
   â†“
ğŸ“ Suggests migration code
   â†“
âœ… Provides implementation guide
```

**All autonomously, in seconds.**

</td>
</tr>
</table>

### ğŸ¯ **10 Predefined Superpowers** (Skills sourced from [Superpowers Laravel](https://github.com/jpcaparas/superpowers-laravel))

Choose from powerful preset actions or write your own custom prompts:

<table>
<tr>
<td width="33%">

**ğŸ¥ System Health Analysis**
Complete diagnostic sweep with recommendations

**ğŸ› Debug Recent Errors**
Pattern analysis & root cause identification

**âš¡ Database Query Analysis**
N+1 detection & optimization suggestions

**ğŸ”’ Security Audit**
Vulnerability scanning & remediation

</td>
<td width="33%">

**ğŸ§ª Test Coverage Analysis**
Identify gaps & suggest tests

**âœ¨ Code Quality Review**
Best practices & refactoring opportunities

**ğŸš€ Performance Analysis**
Bottleneck detection & optimization

</td>
<td width="34%">

**ğŸ“š API Documentation**
Auto-generate comprehensive docs

**ğŸ“¦ Dependency Audit**
Security & compatibility checks

**ğŸ—„ï¸ Migration Review**
Schema optimization analysis

</td>
</tr>
</table>

### ğŸª **How It Works**

1. Navigate to `/admin/system`
2. Select a **Quick Action** from the dropdown (or write your own prompt)
3. Click **"Invoke Codex"**
4. Watch Codex **autonomously analyze** your application using:
    - ğŸ“ **Log analysis** - Pattern recognition in errors
    - âš™ï¸ **Configuration checks** - Setting validation
    - ğŸ§  **Codex CLI** - Non-interactive runs via `codex exec` with your service key

**Codex uses Codex CLI with local context (system info, error extracts, log tail) to provide actionable insights.**

---

<div align="center">

### ğŸ’« **This is the future of application maintenance** ğŸ’«

**No more manual debugging sessions. No more guessing. Just ask Codex.**

ğŸ‰ **Chat Bridge: The first self-aware, self-diagnosing Laravel application** ğŸ‰

</div>

---

## âœ¨ Features at a Glance

<table>
<tr>
<td width="50%">

### ğŸ­ **Persona System**

Create reusable AI persona templates with:

- ğŸ”§ Custom system prompts & guidelines
- ğŸª„ **Built-in AI Persona Creator Bot** popout on the Persona create screen
  - Uses your **OpenAI service API key** (not per-user API key records)
  - Auto-generates and auto-fills both **Persona Name** and **System Prompt**
- ğŸŒ¡ï¸ Default temperature controls (0.0-2.0)
- ğŸ”„ **Provider/model-agnostic design**
- ğŸ‘¥ Shared library - 56 pre-configured personas
- ğŸ“ Creator attribution tracking
- âœï¸ Full CRUD operations
- ğŸ¯ Reusable across any AI provider

</td>
<td width="50%">

### ğŸ’¬ **Conversation Engine**

Orchestrate AI discussions with:

- âš¡ Real-time streaming via WebSockets
- ğŸ§¾ Floating live event log panel on session view (chunks, status, completion, errors)
- ğŸ”„ Automated multi-turn dialogues (configurable max rounds)
- ğŸ¯ Manual stop/resume controls
- ğŸ›‘ **Smart stop-word detection with thresholds**
- ğŸ¤– **Per-conversation provider/model selection**
- ğŸ’° **Live pricing display for 344+ models**
- ğŸ“¡ Live status broadcasting
- ğŸ”” Optional Discord broadcast per conversation (webhook + thread support)
- ğŸ’¾ Complete conversation history
- ğŸ“¥ Transcript export (CSV)

</td>
</tr>
<tr>
<td width="50%">

### ğŸ” **Security & Auth**

Enterprise-grade protection:

- ğŸ”’ Encrypted API key storage
- ğŸ‘¤ Role-based access (User/Admin)
- ğŸ”‘ Per-user credential isolation
- âœ… Real-time API key validation
- ğŸ›¡ï¸ CSRF & XSS protection
- ğŸ” Password hashing (bcrypt)

</td>
<td width="50%">

### ğŸ§  **RAG Intelligence**

Contextual AI with memory:

- ğŸ—„ï¸ Qdrant vector database
- ğŸ” Semantic message search
- ğŸ’­ Persistent conversation memory
- âš¡ Sub-10ms retrieval times
- ğŸ¯ Context-aware responses
- ğŸ“Š Automatic embeddings

</td>
<td width="50%">

### ğŸ¤– **AI Chatbot**

Ask questions about your transcripts:

- ğŸ’¬ Natural-language Q&A over chat history
- ğŸ§  Semantic retrieval via Qdrant embeddings
- ğŸ”‘ Uses your stored OpenAI API key
- âš™ï¸ Per-session settings (model, temperature, prompt, score threshold)
- ğŸ“ Source attribution with similarity scores
- ğŸŸ¢ Dashboard badge shows API key status

</td>
</tr>
<tr>
<td width="50%">

### ğŸ› ï¸ **MCP Tool Calling**

AI personas with superpowers:

- ğŸ” **search_conversations** - Find past messages by keyword
- ğŸ§  **get_contextual_memory** - Vector similarity search
- ğŸ“‹ **get_recent_chats** - Retrieve recent conversations
- ğŸ’¬ **get_conversation** - Load full conversation history
- ğŸ¤– **Agentic loop** - AI autonomously calls tools as needed
- âš™ï¸ **Provider support** - OpenAI, Anthropic, Gemini

</td>
<td width="50%">

### ğŸ“Š **Analytics Suite**

Deep insights into conversations:

- ğŸ“ˆ 7-day activity trends (charts)
- ğŸ‘¥ Top persona statistics
- ğŸ§ª Full SQL playground (read-only `SELECT` / `WITH`)
- âœ¨ SQL examples, schema browser, and inline autocomplete
- ğŸ“¥ CSV export (1000 records)
- ğŸ’¬ Message & token tracking
- ğŸ“Š Real-time metrics
- ğŸ’° Chart pricing accuracy via live provider pricing sync + `model_prices` persistence

</td>
</tr>
<tr>
<td width="50%">

### ğŸ› **Debug Tools**

Professional debugging suite:

- ğŸ”­ **Laravel Telescope** - Monitor everything
- ğŸ› **Laravel Debugbar** - Real-time profiling
- ğŸ§ª **System Diagnostics** - Health checks
- ğŸ¤– **Codex CLI + Boost MCP** - Admin-managed service key with test/clear controls
- ğŸ“ Enhanced logging system
- ğŸ”§ Maintenance automation
- âœ¨ Code style fixer (Pint)

</td>
</tr>
</table>

### ğŸ¨ **Midnight Glass UI Design**

<img width="1134" height="1571" alt="image" src="https://github.com/user-attachments/assets/7ad92e4f-cddf-4435-8aa5-3b8b50c05664" />

<img width="1144" height="1609" alt="image" src="https://github.com/user-attachments/assets/9bca1b5a-4526-4208-b7ce-1943d08cded8" />

<img width="1133" height="923" alt="image" src="https://github.com/user-attachments/assets/c83a0fe2-eaf9-4216-beec-bb6f2b72f987" />

<img width="1131" height="765" alt="image" src="https://github.com/user-attachments/assets/b7d85765-8b2c-4798-94af-5ad953c7c660" />

<img width="1136" height="724" alt="image" src="https://github.com/user-attachments/assets/456ece67-601f-42e8-beac-62f5c6fc101f" />

<img width="1134" height="1365" alt="image" src="https://github.com/user-attachments/assets/c5ad7156-85db-4aa8-9f58-609786ff23ca" />

<img width="1132" height="1943" alt="image" src="https://github.com/user-attachments/assets/18b32b75-8013-4e3b-955d-e99db8d9d013" />

<img width="1154" height="781" alt="image" src="https://github.com/user-attachments/assets/a038e775-f7a9-4b6c-925a-1cfd73d8025a" />

<img width="1150" height="1725" alt="image" src="https://github.com/user-attachments/assets/06b60398-95bf-4e6a-a7fb-9c69c3608ec2" />

<img width="1135" height="1070" alt="image" src="https://github.com/user-attachments/assets/5fa3de8f-9bc4-4daa-a54a-10a2d7efa978" />

<img width="1133" height="1049" alt="image" src="https://github.com/user-attachments/assets/77aa1510-3a88-44d8-b1ce-051489814663" />

<img width="1146" height="845" alt="image" src="https://github.com/user-attachments/assets/00230bc2-752b-479d-8e31-6863bc885c06" />

<img width="1137" height="811" alt="image" src="https://github.com/user-attachments/assets/d45adcd7-3298-4e55-81b3-2d2d2a708e6e" />

<img width="1140" height="1088" alt="image" src="https://github.com/user-attachments/assets/b9726e61-fc0a-4162-a2a9-91b72b0ba32a" />


<table>
<tr>
<td align="center">
<img src="https://img.shields.io/badge/Theme-Dark%20Only-181818?style=for-the-badge" alt="Dark Theme"/>
<br/>
<strong>Fully Dark UI</strong>
</td>
<td align="center">
<img src="https://img.shields.io/badge/Design-Glassmorphic-00D9FF?style=for-the-badge" alt="Glassmorphic"/>
<br/>
<strong>Frosted Glass Effects</strong>
</td>
<td align="center">
<img src="https://img.shields.io/badge/Colors-Gradient-FF6B6B?style=for-the-badge" alt="Gradients"/>
<br/>
<strong>Beautiful Gradients</strong>
</td>
<td align="center">
<img src="https://img.shields.io/badge/UX-Smooth-4ECDC4?style=for-the-badge" alt="Smooth"/>
<br/>
<strong>Buttery Animations</strong>
</td>
</tr>
</table>

Our custom-designed dark theme features:

- ğŸŒ‘ **Deep zinc-950 background** - True black for OLED displays
- âœ¨ **Glassmorphic panels** - Frosted glass with backdrop blur
- ğŸ¨ **Gradient accents** - Blue, purple, emerald, and cyan themes
- ğŸ“œ **Custom scrollbars** - Styled for dark mode
- ğŸ­ **Hover effects** - Elegant micro-interactions
- ğŸ’« **Glow effects** - Subtle shadows on interactive elements

### ğŸ³ **Docker Deployment**

```bash
# One command to rule them all
docker compose up -d
```

**Includes:**

- ğŸš€ Nginx + PHP-FPM application server
- ğŸ—„ï¸ PostgreSQL 16 database
- ğŸ’¾ Redis caching & queues
- ğŸ”Œ Laravel Reverb WebSocket server
- ğŸ‘· Background queue workers
- ğŸ§  Qdrant vector database for RAG

All services configured, optimized, and ready for production!

### âš¡ **Performance**

<table>
<tr>
<td align="center">
<h3>ğŸš€</h3>
<strong>Sub-10ms</strong><br/>
Vector Search
</td>
<td align="center">
<h3>âš¡</h3>
<strong>20 min</strong><br/>
Long Conversations
</td>
<td align="center">
<h3>ğŸ“Š</h3>
<strong>N+1</strong><br/>
Query Prevention
</td>
<td align="center">
<h3>ğŸ”„</h3>
<strong>Real-time</strong><br/>
WebSocket Streaming
</td>
</tr>
</table>

- Async job processing with **4 parallel queue workers** (supervisord)
- Redis-backed queue system
- Efficient database queries
- Real-time streaming responses
- Optimized for scale

---

## ğŸ› ï¸ Tech Stack

<table>
<tr>
<td valign="top" width="50%">

### **Backend Excellence**

ğŸ”¥ **Framework**

- Laravel 12.x (Latest)
- PHP 8.2+ with strict types

ğŸ—„ï¸ **Data Layer**

- PostgreSQL 16 (Production)
- SQLite (Development)
- Redis (Cache & Queue)
- Qdrant (Vector Database)

âš¡ **Real-time**

- Laravel Reverb (WebSockets)
- Laravel Echo (Client)
- Server-Sent Events

ğŸ” **Authentication**

- Laravel Breeze
- Laravel Sanctum
- Role-based Access Control

ğŸ¤– **AI Integration**

- Neuron AI (Multi-provider)
- Saloon PHP (HTTP Client)
- 8+ AI Provider Support

</td>
<td valign="top" width="50%">

### **Frontend Magic**

âš›ï¸ **UI Framework**

- React 18
- Inertia.js 2.0
- TypeScript Support

ğŸ¨ **Styling**

- Tailwind CSS v3
- Custom Dark Theme
- Glassmorphic Design
- CSS-in-JS Compatible

ğŸ“Š **Visualization**

- Recharts (Analytics)
- Custom Chart Components
- Real-time Updates

ğŸ”§ **Build Tools**

- Vite 7 (Lightning Fast)
- NPM/Yarn
- Hot Module Replacement

ğŸ› **Developer Tools**

- Laravel Telescope
- Laravel Debugbar
- Laravel Pint (Code Style)
- PHPUnit/Pest (Testing)

</td>
</tr>
</table>

### **ğŸ¯ Supported AI Providers**

| Provider         | Models                                 | Dynamic Fetching | Status    |
| ---------------- | -------------------------------------- | ---------------- | --------- |
| ğŸ¤– OpenAI        | GPT-4o, GPT-4 Turbo, etc.              | âœ… API           | âœ… Active |
| ğŸ§  Anthropic     | Claude Sonnet 4.5, Opus 4.5, Haiku 4.5 | âœ… API           | âœ… Active |
| ğŸŒŸ Google Gemini | Gemini 2.0 Flash, 2.0 Flash Lite, 1.5 Pro | âš™ï¸ Static        | âœ… Active |
| ğŸš€ DeepSeek      | DeepSeek Chat, R1                      | âš™ï¸ Static        | âœ… Active |
| ğŸ”€ OpenRouter    | **344+ models** with live pricing      | âœ… API           | âœ… Active |
| ğŸ  Ollama        | Local Models                           | âœ… Auto-detect   | âœ… Active |
| ğŸ’» LM Studio     | Local Models                           | âœ… Auto-detect   | âœ… Active |
| ğŸ§ª Mock          | Testing & Development                  | N/A              | âœ… Active |

---

## ğŸ”§ Admin & Developer Tools

Chat Bridge includes a comprehensive suite of professional tools for system administration and debugging:

### ğŸ§ª **System Diagnostics Dashboard** (`/admin/system`)

A powerful web-based control panel with 9 diagnostic actions:

| Action             | Description                           | Use Case             |
| ------------------ | ------------------------------------- | -------------------- |
| ğŸ¥ Health Check    | Complete system status overview       | Quick sanity check   |
| ğŸ” Fix Permissions | Repair file permissions automatically | After deployment     |
| ğŸ—‘ï¸ Clear Caches    | Clear config, routes, views, events   | Development workflow |
| âš¡ Optimize App    | Cache configs for production          | Before going live    |
| ğŸ¤– Validate AI     | Test all AI service connections       | API key validation   |
| ğŸ—„ï¸ Check Database  | Database health & statistics          | Monitoring           |
| ğŸ§ª Run Tests       | Execute full PHPUnit test suite       | CI/CD integration    |
| âœ¨ Fix Code Style  | Auto-fix with Laravel Pint            | Code quality         |
| â¬†ï¸ Update Laravel  | Update `laravel/framework` safely     | Framework maintenance |

**System Information Panel:**

- PHP & Laravel versions
- Environment & debug status
- Memory limit & execution time
- Disk space usage
- Cache & Queue drivers
- File permission status

**Codex Service Key Panel:**

- Set a single OpenAI service key for Codex/Boost diagnostics
- Test key connectivity from the dashboard
- Clear the stored key when rotating credentials
- Codex CLI is bundled in the app image and uses the same service key

### ğŸ”­ **Laravel Telescope** (`/telescope`)

Professional application monitoring:

- ğŸ“Š Request/Response tracking
- ğŸ› Exception monitoring
- ğŸ’¾ Database query profiling
- ğŸ“¬ Job & Queue monitoring
- ğŸ“§ Mail & Notification tracking
- ğŸ“ Log aggregation
- â±ï¸ Performance metrics

**Dark theme enabled** â€¢ **Admin-only access** â€¢ **Production-ready**

### ğŸ› **Laravel Debugbar**

Real-time profiling bar (bottom of page):

- âš¡ Query profiling with execution time
- ğŸ§  Memory usage tracking
- â±ï¸ Timeline visualization
- ğŸ“ Included files list
- ğŸ”€ Route information
- ğŸ“Š Request/Response data

**Auto-disabled in production** â€¢ **Zero performance impact**

### ğŸ“ˆ **Performance Monitor** (`/admin/performance`)

Request and query-level observability for admins:

- 10-second auto-refresh snapshot API (`/admin/performance/stats`)
- 5-minute latency window (avg, p95, max, error rate)
- DB insights (query count, total DB time, slow query rate)
- Throughput chart (last 15 minutes)
- Slowest route breakdown and recent slow requests
- Recent slow SQL query samples (>= 100ms)
- Queue health and runtime context (DB/cache driver, memory, load)

### ğŸ¤– **Model Context Protocol (MCP) Server** (`/api/mcp`)
Native implementation of the JSON-RPC 2.0 MCP protocol for developer interaction:

- Standardized `initialize`, `tools/list`, and `tools/call` methods
- Protocol Version: `2024-11-05`
- Compatible with [Crush](https://crush.charm.land) and other MCP clients
- Securely exposes chat search, recent history, and system statistics as tools

For full integration guide, see **[MCP.md](MCP.md)**

---

## ğŸ“‹ Requirements

- PHP >= 8.2
- Composer
- Node.js >= 18
- NPM or Yarn
- SQLite (or MySQL/PostgreSQL)

---

## ğŸš€ Installation

### 1. Clone the Repository

```bash
git clone <repository-url>
cd chat_bridge
```

### 2. Install Dependencies

```bash
composer install
npm install
```

### 3. Environment Setup

```bash
cp .env.example .env
php artisan key:generate
```

### 4. Configure Database

```bash
touch database/database.sqlite
php artisan migrate --force
```

Note: when `DB_CONNECTION=sqlite`, Chat Bridge now auto-creates a missing SQLite file on boot. The command above is still recommended for first-time setup.

### 5. Build Assets

```bash
npm run build
```

### 6. Start the Application

For automatic port selection and service management (recommended):

```bash
chmod +x start-services.sh
./start-services.sh
```

This script will:

1. Find available ports for Web and WebSocket servers
2. Configure your environment
3. Rebuild frontend assets
4. Start Web Server, Reverb, and Queue
5. Display the access URLs

Or run manually:

```bash
php artisan serve
php artisan queue:work
php artisan reverb:start
```

---

## ğŸ³ Docker Deployment

For production deployment or easier setup, use Docker:

### Quick Start with Docker

```bash
# 1. Clone repository
git clone <repository-url>
cd chat_bridge

# 2. Copy Docker environment file
cp .env.docker .env

# 3. Configure your API keys in .env
nano .env

# 4. Start all services
make setup
# Or: docker compose up -d

# 5. Access the application
# Web: http://localhost:8000
# WebSocket: http://localhost:8080
# Qdrant: http://localhost:6333/dashboard
```

### Switching From Host Mode To Docker Mode

If you previously ran with host PHP + SQLite, switch back to Docker-safe settings with:

```bash
cd ~/chat_bridge
cp .env.docker .env
docker compose up -d
docker compose exec -T app php artisan optimize:clear
docker compose exec -T app php artisan queue:restart
```

**Data persistence:** Docker volumes are preserved by default. Use `make clean-volumes` only when you want to wipe the database and Qdrant data.

### Docker Services

The Docker deployment includes:

- **app**: Laravel application (Nginx + PHP-FPM)
- **queue**: 4 parallel background workers for conversations (supervisord)
- **reverb**: WebSocket server for real-time updates
- **postgres**: PostgreSQL database
- **redis**: Redis for caching and queue
- **qdrant**: Vector database for RAG

### Initialize RAG

After starting Docker services:

```bash
# Initialize Qdrant vector database
make init

# (Optional) Generate embeddings for existing messages
make embeddings

# (Optional) Sync existing messages to Qdrant
make sync
```

### Common Docker Commands

```bash
make up           # Start all services
make down         # Stop all services
make logs         # View all logs
make shell        # Open shell in app container
make migrate      # Run migrations
make clean        # Remove all containers (keeps volumes)
make clean-volumes # Remove all containers and volumes (destructive)
```

For detailed Docker documentation, see **[DOCKER.md](DOCKER.md)**

Docker troubleshooting highlights:

- If Docker builds fail with `permission denied` on `storage/postgres`, see the new troubleshooting section in `DOCKER.md`.
- After changing PHP dependencies (`composer.json` / `composer.lock`), rebuild images: `docker compose build app queue reverb && docker compose up -d app queue reverb`.

For RAG functionality guide, see **[RAG_GUIDE.md](RAG_GUIDE.md)**

---

## ğŸ® Quick Start

### Development Mode

```bash
composer dev
```

This single command starts:

- ğŸŒ Laravel development server (port 8000)
- ğŸ“¦ Queue worker
- ğŸ“ Log viewer (Pail)
- âš¡ Vite dev server (HMR)
- ğŸ”Œ Reverb WebSocket server

### Production Build

```bash
npm run build
php artisan optimize
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

---

## ğŸ“– Usage Guide

### 1. Login with Default Admin

Visit `http://localhost:8000/login` (or `http://localhost:8002` for Docker) and use the default credentials:

- **Email**: `admin@chatbridge.local`
- **Password**: `password`

This admin user is automatically created with full admin rights during installation via database seeder.

### 2. Add API Keys

1. Navigate to `/api-keys`
2. Click "Add API Key"
3. Select provider (e.g., "openai" or "anthropic")
4. Paste your API key
5. Add a label (optional)
6. Save

### 3. Create Personas

1. Go to `/personas`
2. Click "Create Persona"
3. Configure:
    - **Name**: Unique identifier
    - **System Prompt**: Instructions for the AI's personality and behavior
    - **Default Temperature**: 0.0 (deterministic) to 2.0 (creative)
    - **Notes**: Optional internal notes
4. Save

> ğŸ’¡ **Note**: Personas are now provider/model-agnostic templates! You select the provider and model when creating a conversation, allowing you to reuse the same persona with different AI models.

### 4. Start a Conversation

1. Navigate to `/chat/create`
2. Configure **Agent A**:
   - Select persona template
   - Choose AI provider (Anthropic, OpenAI, OpenRouter, etc.)
   - Select model from **dynamically fetched list** with pricing
3. Configure **Agent B**:
   - Select persona template
   - Choose AI provider (can be different from Agent A!)
   - Select model with live pricing
4. Enter **Starter Message**
5. Configure **Chat Control Settings**:
    - **Max Rounds**: Limit conversation turns (1-100)
    - **Stop Word Detection**: Enable automatic stopping
    - **Stop Words**: Comma-separated trigger words (e.g., "goodbye, end")
    - **Threshold**: Detection sensitivity (0.1-1.0)
    - **Discord Broadcast** (optional): Stream conversation updates to Discord
    - **Discord Webhook Override** (optional): Leave blank to use your profile/system default
6. Click "Begin Simulation"
7. Watch the real-time conversation unfold!

> ğŸ’° **Pricing**: All models display cost per 1M tokens (input/output) so you can make informed decisions!

### 5. Monitor Conversations

- View active conversations on `/chat`
- Click any conversation to see details
- Use the stop button to halt long conversations
- Download transcripts for analysis

### 6. Run Analytics SQL Queries

1. Open `/analytics/query`
2. Use an example query or type your own SQL
3. Use autocomplete suggestions for keywords/tables/columns
4. Press `Ctrl+Enter` or `Cmd+Enter` to run
5. Adjust row limit (1-500) and export filtered results to CSV

Notes:
- The SQL runner allows read-only `SELECT` and `WITH` queries only
- Multi-statement and write operations are blocked for safety

---

## ğŸ—‚ï¸ Project Structure

```
chat_bridge/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ Admin/UserController.php      # User management
â”‚   â”‚   â”‚   â”œâ”€â”€ ApiKeyController.php           # API key CRUD
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatController.php             # Conversations
â”‚   â”‚   â”‚   â””â”€â”€ PersonaController.php          # Persona CRUD
â”‚   â”‚   â””â”€â”€ Middleware/
â”‚   â”‚       â””â”€â”€ EnsureUserIsAdmin.php          # Admin middleware
â”‚   â”œâ”€â”€ Jobs/
â”‚   â”‚   â”œâ”€â”€ RunChatSession.php                 # Main conversation loop
â”‚   â”‚   â””â”€â”€ ProcessConversationTurn.php        # Single turn handler
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ User.php                           # User model
â”‚   â”‚   â”œâ”€â”€ Persona.php                        # AI agent config
â”‚   â”‚   â”œâ”€â”€ Conversation.php                   # Chat session
â”‚   â”‚   â”œâ”€â”€ Message.php                        # Individual message
â”‚   â”‚   â””â”€â”€ ApiKey.php                         # Encrypted API keys
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ AI/
â”‚   â”‚   â”‚   â”œâ”€â”€ AIManager.php                  # AI provider abstraction
â”‚   â”‚   â”‚   â””â”€â”€ EmbeddingService.php           # Vector embeddings
â”‚   â”‚   â”œâ”€â”€ System/
â”‚   â”‚   â”‚   â””â”€â”€ [System services]              # System utilities
â”‚   â”‚   â”œâ”€â”€ ConversationService.php            # Turn generation
â”‚   â”‚   â”œâ”€â”€ TranscriptService.php              # Export conversations
â”‚   â”‚   â””â”€â”€ AnalyticsController.php            # Analytics and queries
â”‚   â””â”€â”€ Events/
â”‚       â”œâ”€â”€ MessageChunkSent.php               # Streaming chunks
â”‚       â”œâ”€â”€ MessageCompleted.php               # Full message
â”‚       â””â”€â”€ ConversationStatusUpdated.php      # Status changes
â”œâ”€â”€ database/
â”‚   â””â”€â”€ migrations/                            # Database schema
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ Pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/                          # Login/Register
â”‚   â”‚   â”‚   â”œâ”€â”€ Chat/                          # Conversation UI
â”‚   â”‚   â”‚   â”œâ”€â”€ Personas/                      # Persona management
â”‚   â”‚   â”‚   â”œâ”€â”€ ApiKeys/                       # API key management
â”‚   â”‚   â”‚   â”œâ”€â”€ Analytics/                     # Analytics dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ Admin/                         # Admin panel
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard.jsx                  # Main dashboard
â”‚   â”‚   â””â”€â”€ app.jsx                            # React entry point
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ app.css                            # Tailwind + custom dark theme
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ web.php                                # Web routes
â”‚   â”œâ”€â”€ api.php                                # API routes
â”‚   â””â”€â”€ channels.php                           # Broadcast channels
â”œâ”€â”€ LARAVEL_ENHANCEMENTS.md                    # UX improvement suggestions
â””â”€â”€ ROADMAP.md                                 # Future development plan
```

---

## ğŸ”’ Security Features

- âœ… Encrypted API key storage
- âœ… CSRF protection
- âœ… SQL injection prevention (Eloquent ORM)
- âœ… XSS protection (React/Blade escaping)
- âœ… Password hashing (bcrypt)
- âœ… User data isolation
- âœ… Role-based access control
- âœ… Middleware authentication checks

---

## ğŸŒ API Endpoints

### Authentication

- `POST /register` - Register new user
- `POST /login` - User login
- `POST /logout` - User logout

### Conversations

- `GET /chat` - List conversations
- `POST /chat` - Create conversation (with provider/model selection & chat controls)
- `GET /chat/{id}` - View conversation
- `POST /chat/{id}/stop` - Stop conversation
- `DELETE /chat/{id}` - Delete conversation
- `GET /chat/{id}/transcript` - Download transcript

### Provider API

- `GET /api/providers/models?provider={name}` - Get available models for provider (with pricing)
    - Also upserts provider/model token pricing into `model_prices` for analytics cost estimation

### Personas

- `GET /personas` - List personas
- `POST /personas` - Create persona
- `GET /personas/{id}/edit` - Edit form
- `PUT /personas/{id}` - Update persona
- `DELETE /personas/{id}` - Delete persona

### API Keys

- `GET /api-keys` - List API keys
- `POST /api-keys` - Add API key
- `PUT /api-keys/{id}` - Update API key
- `DELETE /api-keys/{id}` - Delete API key
- `POST /api-keys/{id}/test` - Validate API key with provider

### AI Chatbot

- `GET /transcript-chat` - Ask the Archive interface
- `POST /transcript-chat/ask` - Submit a question (supports `system_prompt`, `model`, `temperature`, `max_tokens`, `source_limit`, `score_threshold`)

### Analytics

- `GET /analytics` - Analytics dashboard with charts
- `GET /analytics/query` - Query page with filters + SQL playground
- `POST /analytics/query/run-sql` - Execute read-only SQL (`SELECT` / `WITH`)
- `POST /analytics/export` - Export conversations to CSV

### Admin (Requires Admin Role)

- `GET /admin/users` - List all users
- `POST /admin/users` - Create user
- `PUT /admin/users/{id}` - Update user
- `DELETE /admin/users/{id}` - Delete user
- `GET /admin/performance` - Performance monitor dashboard
- `GET /admin/performance/stats` - Performance monitor JSON snapshot

### External API

- `POST /api/chat-bridge/respond` - Chat bridge endpoint (requires token)

### MCP Server

- `POST /api/mcp` - Native MCP JSON-RPC 2.0 endpoint (no auth required for local dev)

---

## âš™ï¸ Configuration

### Environment Variables

```env
APP_NAME="Chat Bridge"
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=sqlite
# Or for production:
# DB_CONNECTION=mysql
# DB_HOST=127.0.0.1
# DB_PORT=3306
# DB_DATABASE=chat_bridge
# DB_USERNAME=root
# DB_PASSWORD=

QUEUE_CONNECTION=database
CACHE_DRIVER=file
SESSION_DRIVER=file

REVERB_APP_ID=your-app-id
REVERB_APP_KEY=your-app-key
REVERB_APP_SECRET=your-app-secret

# Discord conversation broadcasting
DISCORD_STREAMING_ENABLED=true
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...
DISCORD_THREAD_AUTO_CREATE=true
DISCORD_CIRCUIT_BREAKER_THRESHOLD=5

# Add your AI provider keys to database via UI
# DO NOT store them in .env for security
```

### AI Provider Setup

Chat Bridge supports multiple AI providers through the Neuron AI package:

- **OpenAI**: GPT-4, GPT-3.5, etc.
- **Anthropic**: Claude 3.5 Sonnet, Claude 3 Opus, etc.
- **Custom**: Extend with additional providers

Add API keys via the web interface (`/api-keys`) for secure encrypted storage.

---

## ğŸ§ª Testing

The project includes automated testing via PHPUnit and GitHub Actions.

```bash
# Run all tests
php artisan test

# Run specific test file
php artisan test tests/Feature/ConversationTest.php

# Run with coverage
php artisan test --coverage

# Use the interactive test runner
./run_tests.sh
```

**Or use the System Diagnostics panel** at `/admin/system` to run tests via the web interface!

---

## ğŸ› Troubleshooting

### Queue Not Processing

```bash
php artisan queue:work --tries=1
```

> This project uses Laravel queue workers (`queue:work` / `queue:restart`), not Horizon.

### WebSocket Connection Failed

Check Reverb is running:

```bash
php artisan reverb:start
```

### Discord Broadcast Not Posting

If conversations are not appearing in Discord:

```bash
# Global feature switch
DISCORD_STREAMING_ENABLED=true

# Optional global fallback webhook
# DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/...

# Restart workers after changing config/env
php artisan optimize:clear
php artisan queue:restart
```

Also confirm the conversation has **Discord Broadcast** enabled and that either:
- conversation webhook override is set, or
- user profile default webhook is set, or
- global `DISCORD_WEBHOOK_URL` is configured.

### Broadcast Payload Too Large

If messages vanish or you see payload size errors, lower streaming chunk size or raise Reverb limits:

```bash
# Lower broadcast chunk size (safer for large personas)
AI_STREAM_CHUNK_SIZE=600

# Increase Reverb request/message limits (local Reverb only)
REVERB_MAX_REQUEST_SIZE=25000
REVERB_APP_MAX_MESSAGE_SIZE=25000
```

Then restart the services:

```bash
php artisan queue:restart
```

### Conversation Stops Early (Empty Turn)
If a provider occasionally returns an empty response, tune retry behavior:
```bash
# Retry empty turns before failing the conversation
AI_EMPTY_TURN_RETRY_ATTEMPTS=2
AI_EMPTY_TURN_RETRY_DELAY_MS=500
```

Apply config changes and restart workers:
```bash
php artisan optimize:clear
php artisan queue:restart
```

### Provider Timeouts (cURL error 28)
If first-token latency is high for some models, increase provider HTTP resilience:
```bash
AI_HTTP_TIMEOUT_SECONDS=90
AI_HTTP_CONNECT_TIMEOUT_SECONDS=15
AI_HTTP_RETRY_ATTEMPTS=2
AI_HTTP_RETRY_DELAY_MS=500
```

### Build Errors

Clear cache and rebuild:

```bash
php artisan config:clear
php artisan cache:clear
php artisan view:clear
npm run build
```

### SQLite File Missing

If you see `Database file at path ... database.sqlite does not exist`:

```bash
touch database/database.sqlite
php artisan migrate --force
```

Also confirm `DB_DATABASE` is an absolute path in `.env` when running inside Docker.

### Gemini Model Not Supported

If API key testing fails with `is not found for API version`:

```bash
# Prefer a v1beta-supported default
GEMINI_MODEL=gemini-2.0-flash
php artisan optimize:clear
```

You can list available models for your key:

```bash
curl "https://generativelanguage.googleapis.com/v1beta/models?key=YOUR_KEY"
```

### Database Locked (SQLite)

Stop all queue workers and retry:

```bash
php artisan queue:restart
php artisan migrate --force
```

---

## ğŸ“š Documentation

### ğŸ“– Chat Bridge Documentation

| Document                                         | Description                     |
| ------------------------------------------------ | ------------------------------- |
| **[FEATURES.md](FEATURES.md)**                   | ğŸ¯ Complete feature list (200+) |
| **[DOCKER.md](DOCKER.md)**                       | ğŸ³ Docker deployment guide      |
| **[RAG_GUIDE.md](RAG_GUIDE.md)**                 | ğŸ§  RAG & AI memory guide        |
| **[ROADMAP.md](ROADMAP.md)**                     | ğŸ—ºï¸ Future development plans     |
| **[DATA_MANIPULATION.md](DATA_MANIPULATION.md)** | ğŸ“Š Data operations guide        |
| **[MCP.md](MCP.md)**                             | ğŸ¤– MCP server integration guide |

### ğŸŒ External Documentation

- **[Laravel 12.x](https://laravel.com/docs/12.x)** - Framework documentation
- **[React 18](https://react.dev/)** - UI library guide
- **[Inertia.js](https://inertiajs.com/)** - SPA bridge documentation
- **[Tailwind CSS v3](https://tailwindcss.com/)** - Styling framework
- **[Laravel Reverb](https://reverb.laravel.com/)** - WebSocket server
- **[Qdrant](https://qdrant.tech/documentation/)** - Vector database
- **[Laravel Telescope](https://laravel.com/docs/telescope)** - Debug tool
- **[Recharts](https://recharts.org/)** - Charting library

---

## ğŸ¤ Contributing

Contributions are welcome! Please follow these steps:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

---

## ğŸ“„ License

This project is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).

---

## ğŸ¯ Quick Stats

<div align="center">

| Metric                         | Count         |
| ------------------------------ | ------------- |
| ğŸ­ **Pre-configured Personas** | 56            |
| ğŸ¤– **AI Providers Supported**  | 8+            |
| âœ¨ **Features**                | 200+          |
| ğŸ¨ **Custom CSS Utilities**    | 15+           |
| ğŸ“Š **Admin Dashboard Actions** | 8             |
| ğŸ§ª **Test Coverage**           | Comprehensive |
| ğŸ“¦ **Total Dependencies**      | 93+           |
| âš¡ **Vector Search Speed**     | <10ms         |

</div>

---

## ğŸŒŸ What Makes Chat Bridge Special?

<table>
<tr>
<td width="50%">

### ğŸ¨ **Stunning UI**

Not just functionalâ€”beautiful! Our custom "Midnight Glass" dark theme with glassmorphic design makes working with AI agents a visual treat.

### ğŸ”§ **Developer-First**

Built by developers, for developers. Includes Telescope, Debugbar, comprehensive testing, and a full diagnostics suite.

</td>
<td width="50%">

### ğŸš€ **Production-Ready**

Not a toy project. Enterprise-grade security, performance optimization, Docker deployment, and comprehensive monitoring.

### ğŸ§  **Intelligent**

RAG-powered conversations with persistent memory. Your AI agents remember context across sessions for truly intelligent discussions.

</td>
</tr>
</table>

---

## ğŸ™ Acknowledgments

Powered by amazing open-source projects:

- **[Laravel](https://laravel.com)** - The PHP Framework for Web Artisans
- **[React](https://react.dev)** - A JavaScript library for building user interfaces
- **[Inertia.js](https://inertiajs.com)** - The Modern Monolith
- **[Tailwind CSS](https://tailwindcss.com)** - A utility-first CSS framework
- **[Vite](https://vitejs.dev)** - Next Generation Frontend Tooling
- **[Qdrant](https://qdrant.tech)** - Vector Database for AI
- **[Laravel Reverb](https://reverb.laravel.com)** - Blazing fast WebSockets
- **[Neuron AI](https://github.com/UseNeuron/neuron)** - Multi-provider AI SDK

---

## ğŸ“ Support & Community

- ğŸ“§ **Issues**: [GitHub Issues](https://github.com/meistro57/chat_bridge/issues)
- ğŸ’¬ **Discussions**: [GitHub Discussions](https://github.com/meistro57/chat_bridge/discussions)
- ğŸ› **Bug Reports**: Use GitHub Issues with the `bug` label
- âœ¨ **Feature Requests**: Use GitHub Issues with the `enhancement` label

---

## ğŸ—ºï¸ What's Next?

Check out our [ROADMAP.md](ROADMAP.md) for upcoming features and improvements!

**Coming Soon:**

- ğŸŒ Multi-language support
- ğŸ“± Mobile app (React Native)
- ğŸ™ï¸ Voice conversation support
- ğŸ”Œ Plugin system
- ğŸ“Š Advanced analytics
- ğŸ¤ Team collaboration features

---

## â­ Star History

If you find Chat Bridge useful, please consider giving it a star! â­

---

<div align="center">

### Made with â¤ï¸ by developers who love AI

**[â¬† back to top](#-chat-bridge)**

---

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](http://makeapullrequest.com)
[![Maintenance](https://img.shields.io/badge/Maintained%3F-yes-green.svg)](https://github.com/meistro57/chat_bridge/graphs/commit-activity)

</div>
