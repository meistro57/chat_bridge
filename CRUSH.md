# CRUSH.md - Project Understanding & Laravel Expertise

## Project Overview: Chat Bridge
Chat Bridge is a sophisticated Laravel 12 application designed to facilitate autonomous AI-to-AI conversations (Chat Sessions) between two distinct Personas. It features a robust, driver-based AI integration layer, real-time updates via WebSockets, and a modern "Midnight Glass" UI.

## Technical Core & Laravel Expertise

### 1. Robust Architecture & Design Patterns
- **Manager Pattern (AIManager)**: Implements a flexible AI provider system. Extending Laravel's `Manager` class allows for dynamic driver resolution (OpenAI, Anthropic, DeepSeek, etc.) based on user configuration or database-stored API keys.
- **Async Job Orchestration**: `RunChatSession` manages the complex, multi-turn AI conversation loop asynchronously. It uses Laravel's Queue system to prevent blocking the UI, with sophisticated stop-signal handling via `Cache`.
- **Relationship-Driven Models**: Clean Eloquent relationships (`Persona`, `Conversation`, `Message`) with strict attribute casting for JSON metadata, temperatures, and state management.

### 2. Modern Frontend (Inertia.js v2 + React)
- **Seamless SPA Experience**: Utilizes Inertia.js to bridge Laravel's powerful backend with a React-based frontend, delivering a fast, single-page application feel without the complexity of a separate API.
- **Midnight Glass System**: A custom UI design implementation leveraging Tailwind CSS v4 variables, translucent backgrounds, and backdrop blurs for a premium dark-mode aesthetic.
- **Real-time Synchronization**: Integrated with **Laravel Reverb** for low-latency broadcasting of message chunks and status updates directly to the React components.

### 3. Advanced Features & Enhancements
- **RAG Integration**: Specialized `RagService` using **Qdrant** for vector-based semantic search, enabling AI personas to retrieve contextually relevant information from long-term memory or document stores.
- **Unified Transmission System**: A flexible abstraction for sending messages across different channels (UI, Webhooks, etc.) with priority levels.
- **Observability & Health**: Custom **System Diagnostics** and **Performance Monitoring** for real-time tracking of DB latency, queue health, and model performance.
- **Security-First Approach**: AES-256 encryption for user-provided API keys and a **Read-Only Safety Mode** for infrastructure stability during sensitive operations.
- **Docker-Optimized Environment**: Uses a multi-container setup (App, Queue, Reverb, Postgres, Redis, Qdrant) with unified UID/GID management to ensure seamless asset building and file persistence across host and container.

## Key Technical Components

| Component | Responsibility |
| :--- | :--- |
| **AIManager** | Provider-agnostic driver resolution & API key management. |
| **RunChatSession** | Background job handling the turn-based AI interaction loop. |
| **RagService** | Vector embedding generation and semantic context retrieval. |
| **DiscordStreamer**| Real-time streaming of AI conversations to Discord channels. |
| **AnalyticsService**| Token tracking, cost estimation, and usage history. |

## Development Philosophy
- **Autonomy**: High degree of self-correction and proactive problem-solving.
- **Precision**: Strict adherence to existing code styles and exact matching for file modifications.
- **Testing**: Commitment to comprehensive feature and unit testing for every modification.
- **Performance**: Heavy use of caching, optimized queries, and async processing for a fluid user experience.

---
*Generated by Crush - Your Autonomous CLI Assistant*
